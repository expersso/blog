---
title: Linear operators
author: EP
draft: true
date: '2017-08-13'
categories:
  - R
  - mathematics
tags:
  - linear algebra
  - matrix
output: html_document
editor_options:
  chunk_output_type: console
---



<pre class="r"><code>library(tidyverse)</code></pre>
<pre><code>## Loading tidyverse: ggplot2
## Loading tidyverse: tibble
## Loading tidyverse: tidyr
## Loading tidyverse: readr
## Loading tidyverse: purrr
## Loading tidyverse: dplyr</code></pre>
<pre><code>## Conflicts with tidy packages ----------------------------------------------</code></pre>
<pre><code>## filter(): dplyr, stats
## lag():    dplyr, stats</code></pre>
<pre class="r"><code>sb_r3 &lt;- list(
  v1 = c(1, 0, 0),
  v2 = c(0, 1, 0),
  v3 = c(0, 0, 1)
)</code></pre>
<pre class="r"><code>lop &lt;- function(f) {
  structure(f, class = c(&quot;lop&quot;, class(f)))
}</code></pre>
<pre class="r"><code>as.matrix.lop &lt;- function(f, basis) {
  n &lt;- length(basis)
  vs &lt;- map(basis, f)
  lift_vl(matrix)(vs, n)
}</code></pre>
<pre class="r"><code>f &lt;- function(u) {
  stopifnot(length(u) == 3)
  x &lt;- u[1]
  y &lt;- u[2]
  z &lt;- u[3]
  c(x + y, 2*x + 3*y, z - 3*y)
}
f &lt;- lop(f)

F &lt;- as.matrix(f, sb_r3)
F</code></pre>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1    1    0
## [2,]    2    3    0
## [3,]    0   -3    1</code></pre>
<pre class="r"><code>w &lt;- c(3, 2, -4)
f(w)</code></pre>
<pre><code>## [1]   5  12 -10</code></pre>
<pre class="r"><code>F %*% w</code></pre>
<pre><code>##      [,1]
## [1,]    5
## [2,]   12
## [3,]  -10</code></pre>
<pre class="r"><code>g &lt;- function(u) {
  stopifnot(length(u) == 3)
  x &lt;- u[1]
  y &lt;- u[2]
  z &lt;- u[3]
  c(x - y, -2*x + 6*y, -2*z + 5*y)
}
g &lt;- lop(g)

G &lt;- as.matrix(g, sb_r3)
G</code></pre>
<pre><code>##      [,1] [,2] [,3]
## [1,]    1   -1    0
## [2,]   -2    6    0
## [3,]    0    5   -2</code></pre>
<pre class="r"><code>F %*% G %*% w</code></pre>
<pre><code>##      [,1]
## [1,]    7
## [2,]   20
## [3,]    0</code></pre>
<pre class="r"><code>f(g(w))</code></pre>
<pre><code>## [1]  7 20  0</code></pre>
<pre class="r"><code>`+.lop` &lt;- function(f, g) {
  function(...) {
    f(...) + g(...)
  }
}</code></pre>
<pre class="r"><code>(f + g)(w)</code></pre>
<pre><code>## [1]  6 18  8</code></pre>
<pre class="r"><code>f(w) + g(w)</code></pre>
<pre><code>## [1]  6 18  8</code></pre>
<pre class="r"><code>F + G</code></pre>
<pre><code>##      [,1] [,2] [,3]
## [1,]    2    0    0
## [2,]    0    9    0
## [3,]    0    2   -1</code></pre>
<pre class="r"><code>(F + G) %*% w</code></pre>
<pre><code>##      [,1]
## [1,]    6
## [2,]   18
## [3,]    8</code></pre>
<pre class="r"><code>as.lop &lt;- function(M) {
  f &lt;- function(u) {
    M %*% u
  }
  lop(f)
}</code></pre>
<pre class="r"><code>as.lop(F)(w)</code></pre>
<pre><code>##      [,1]
## [1,]    5
## [2,]   12
## [3,]  -10</code></pre>
<pre class="r"><code>sb_r2 &lt;- list(
  c(1, 0), 
  c(0, 1)
  )</code></pre>
<pre class="r"><code>rot_90 &lt;- function(u) {
  stopifnot(length(u) == 2)
  x &lt;- u[1]
  y &lt;- u[2]
  th &lt;- pi/2
  c(x*cos(th) - y*sin(th), 
    x*sin(th) + y*cos(th))
}
rot_90 &lt;- lop(rot_90)</code></pre>
<pre class="r"><code>as.matrix(rot_90, sb_r2)</code></pre>
<pre><code>##              [,1]          [,2]
## [1,] 6.123032e-17 -1.000000e+00
## [2,] 1.000000e+00  6.123032e-17</code></pre>
<pre class="r"><code>rot &lt;- function(theta) {
  f &lt;- function(u) {
    stopifnot(length(u) == 2)
    x &lt;- u[1]
    y &lt;- u[2]
    c(x*cos(theta) - y*sin(theta), 
      x*sin(theta) + y*cos(theta))
  }
  lop(f)
}

rot_180 &lt;- rot(pi)</code></pre>
<pre class="r"><code>arr &lt;- function(xend, yend, x = 0, y = 0, ...) {
  annotate(&quot;segment&quot;, x = x, xend = xend, y = y, yend = yend, 
           arrow = arrow(length = unit(2, &quot;mm&quot;), type = &quot;closed&quot;),
           ...)
}
arr_ &lt;- lift(arr)</code></pre>
<pre class="r"><code>p &lt;- ggplot() +
  coord_equal(xlim = c(-2, 2), ylim = c(-2, 2))

w &lt;- c(1.5, 2)

p + 
  arr_(w, color = &quot;red&quot;) +
  arr_(rot(pi/2)(w), color = &quot;orange&quot;) +
  arr_(rot(pi)(w), color = &quot;blue&quot;)</code></pre>
<p><img src="/post/linear_operators_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<pre class="r"><code>df &lt;- data_frame(
  th = seq(0, 2*pi, length.out = 100),
  l = map(th, ~rot(.)(c(1, 0))),
  x = map_dbl(l, 1),
  y = map_dbl(l, 2)
)</code></pre>
<pre class="r"><code>ggplot(df, aes(xend = x, yend = y, color = as.factor(runif(100)))) +
  geom_segment(x = 0, y = 0,
               arrow = arrow(length = unit(2, &quot;mm&quot;), type = &quot;closed&quot;),
               show.legend = FALSE) +
  coord_equal()</code></pre>
<p><img src="/post/linear_operators_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
