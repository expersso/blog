---
title: Fixed points
author: EP
date: "2017-08-12"
draft: true
categories: 
  - R
tags:
  - functional programming
  - mathematics
editor_options:
  chunk_output_type: console
---

```{r opts, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, 
                      fig.height = 3, fig.width = 3, 
                      fig.align = "center")
```

```{r pkgs}
library(tidyverse)
library(gganimate)
```

```{r float_eq}
float_eq <- function(x, y, tol = 1e-2) {
  map2_lgl(x, y,  
            ~isTRUE(all.equal(.x, .y, tolerance = tol))
  )
}
```

```{r fixed_points}
fixed_points <- function(f, x, ..., tol = 1e-2) {
    f_x <- f(x, ...)
    equal <- float_eq(x, f_x, tol = tol)
    unique(x[equal])
}

f <- function(x) x^3

(fp <- fixed_points(f, -10:10))

fp == f(fp)
```

```{r plot_fixed_points}
plot_fixed_points <- function(f, domain) {
  fp <- data_frame(x = domain, y = f(x)) %>% 
    filter(float_eq(x, y))

  ggplot(data.frame(x = domain), aes(x)) +
    geom_hline(yintercept = 0, size = 0.1) +
    geom_vline(xintercept = 0, size = 0.1) +
    stat_function(fun = f, color = "blue") +
    stat_function(fun = function(x) x, color = "red") +
    geom_point(aes(y = y), data = fp) +
    geom_text(aes(y = y, label = sprintf("(%0.1f,%0.1f)", x, y)), 
              data = fp, size = 3, hjust = -0.1, vjust = 2, 
              check_overlap = TRUE) +
    coord_equal(ylim = range(domain)) +
    theme_minimal()
}
```

```{r x_squared}
domain <- -10:10
plot_fixed_points(function(x) x^2, domain)
```

```{r x_cubed}
plot_fixed_points(function(x) x^3, domain)
```

```{r id}
id <- function(x) x
plot_fixed_points(id, domain)
```

```{r const_3}
const_3 <- function(x) 3
plot_fixed_points(const_3, domain)
```

```{r abs}
plot_fixed_points(abs, domain)
```

```{r sign}
plot_fixed_points(sign, domain)
```

```{r complicated_polynomial}
g <- function(x) x^4 + 3 * x^3 + x^2
domain2 <- seq(-4, 2, length.out = 1000)
plot_fixed_points(g, domain2)
```

```{r sin}
plot_fixed_points(sin, domain)
```

```{r cos}
plot_fixed_points(cos, domain2)
```

```{r toupper}
fixed_points(toupper, c(letters, LETTERS))
```

## Attractive fixed points

[Attractive fixed 
point](https://en.wikipedia.org/wiki/Fixed_point_(mathematics)#Attractive_fixed_points)

```{r repeated_cos}
afp <- cos(cos(cos(cos(cos(cos(cos(cos(cos(cos(-1))))))))))
afp
```

```{r iterate}
iterate <- function(f, n, .init, ...) {
  reduce(seq_len(n), ~f(.x, ...), .init = .init)
}

iterate(function(x) x + 2, 3, 0)
```

```{r iapply_cos}
iterate(cos, 10, -1)
```

```{r attactive_fp_cos, eval=FALSE}
xs <- accumulate(1:10, ~cos(.x), .init = -1) %>% 
  list(., .) %>% 
  transpose() %>% 
  flatten() %>% 
  flatten_dbl()

df <- data_frame(
  x     = head(xs, -1), 
  y     = c(0, tail(xs, -2)),
  frame = seq_along(x)
)

p <- plot_fixed_points(cos, domain) +
  coord_equal(ylim = c(0, 1), xlim = c(-1, 1)) +
  geom_path(data = df, aes(x, y, frame = frame, 
                           cumulative = TRUE))
```

```{r save_gif, include=FALSE, eval=FALSE}
gganimate(p, title_frame = FALSE,
          filename = paste0("../../static/post/fixed-points_files",
                            "/figure-html/attractive_fp_cos.gif"))
![](/post/fixed-points_files/figure-html/attractive_fp_cos.gif)
```

